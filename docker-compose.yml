services:
  # SQL Server Database
  sqlserver:
    image: mcr.microsoft.com/azure-sql-edge:latest
    container_name: personaluniverse-sqlserver
    environment:
      - ACCEPT_EULA=Y
      - SA_PASSWORD=YourStrong@Passw0rd
      - MSSQL_PID=Developer
    ports:
      - "1433:1433"
    volumes:
      - sqlserver-data:/var/opt/mssql
    networks:
      - personaluniverse-network

  # RabbitMQ Message Broker
  rabbitmq:
    image: rabbitmq:3-management
    container_name: personaluniverse-rabbitmq
    environment:
      - RABBITMQ_DEFAULT_USER=admin
      - RABBITMQ_DEFAULT_PASS=admin123
    ports:
      - "5672:5672"   # AMQP port
      - "15672:15672" # Management UI
    networks:
      - personaluniverse-network

  # Redis Cache (optional)
  redis:
    image: redis:7-alpine
    container_name: personaluniverse-redis
    ports:
      - "6379:6379"
    networks:
      - personaluniverse-network

  # Identity Service
  identity-service:
    build:
      context: .
      dockerfile: src/Services/Identity/PersonalUniverse.Identity.API/Dockerfile
    container_name: personaluniverse-identity
    environment:
      - ASPNETCORE_ENVIRONMENT=Development
      - ASPNETCORE_URLS=http://+:80
      - ConnectionStrings__DefaultConnection=Server=sqlserver;Database=PersonalUniverseDB;User Id=sa;Password=YourStrong@Passw0rd;TrustServerCertificate=True;
      - Jwt__SecretKey=your-super-secret-key-minimum-32-characters-long-for-jwt
      - Jwt__Issuer=PersonalUniverseSimulator
      - Jwt__Audience=PersonalUniverseClients
      - Jwt__ExpirationMinutes=60
    ports:
      - "5001:80"
    depends_on:
      - sqlserver
    networks:
      - personaluniverse-network

  # Storage Service
  storage-service:
    build:
      context: .
      dockerfile: src/Services/Storage/PersonalUniverse.Storage.API/Dockerfile
    container_name: personaluniverse-storage
    environment:
      - ASPNETCORE_ENVIRONMENT=Development
      - ASPNETCORE_URLS=http://+:80
      - ConnectionStrings__DefaultConnection=Server=sqlserver;Database=PersonalUniverseDB;User Id=sa;Password=YourStrong@Passw0rd;TrustServerCertificate=True;
    ports:
      - "5002:80"
    depends_on:
      - sqlserver
    networks:
      - personaluniverse-network

  # Personality Processing Service
  personality-service:
    build:
      context: .
      dockerfile: src/Services/PersonalityProcessing/PersonalUniverse.PersonalityProcessing.API/Dockerfile
    container_name: personaluniverse-personality
    environment:
      - ASPNETCORE_ENVIRONMENT=Development
      - ASPNETCORE_URLS=http://+:80
      - ConnectionStrings__DefaultConnection=Server=sqlserver;Database=PersonalUniverseDB;User Id=sa;Password=YourStrong@Passw0rd;TrustServerCertificate=True;
    ports:
      - "5003:80"
    depends_on:
      - sqlserver
      - rabbitmq
    networks:
      - personaluniverse-network

  # Simulation Engine
  simulation-service:
    build:
      context: .
      dockerfile: src/Services/SimulationEngine/PersonalUniverse.SimulationEngine.API/Dockerfile
    container_name: personaluniverse-simulation
    environment:
      - ASPNETCORE_ENVIRONMENT=Development
      - ASPNETCORE_URLS=http://+:80
      - ConnectionStrings__DefaultConnection=Server=sqlserver;Database=PersonalUniverseDB;User Id=sa;Password=YourStrong@Passw0rd;TrustServerCertificate=True;
      - RabbitMQ__Host=rabbitmq
      - RabbitMQ__Username=admin
      - RabbitMQ__Password=admin123
    ports:
      - "5004:80"
    depends_on:
      - sqlserver
      - rabbitmq
    networks:
      - personaluniverse-network

  # Event Service
  event-service:
    build:
      context: .
      dockerfile: src/Services/EventService/PersonalUniverse.EventService.API/Dockerfile
    container_name: personaluniverse-events
    environment:
      - ASPNETCORE_ENVIRONMENT=Development
      - ASPNETCORE_URLS=http://+:80
      - RabbitMQ__Host=rabbitmq
      - RabbitMQ__Username=admin
      - RabbitMQ__Password=admin123
    ports:
      - "5005:80"
    depends_on:
      - rabbitmq
    networks:
      - personaluniverse-network

  # Visualization Feed Service
  visualization-service:
    build:
      context: .
      dockerfile: src/Services/VisualizationFeed/PersonalUniverse.VisualizationFeed.API/Dockerfile
    container_name: personaluniverse-visualization
    environment:
      - ASPNETCORE_ENVIRONMENT=Development
      - ASPNETCORE_URLS=http://+:80
      - ConnectionStrings__DefaultConnection=Server=sqlserver;Database=PersonalUniverseDB;User Id=sa;Password=YourStrong@Passw0rd;TrustServerCertificate=True;
    ports:
      - "5006:80"
    depends_on:
      - sqlserver
    networks:
      - personaluniverse-network

networks:
  personaluniverse-network:
    driver: bridge

volumes:
  sqlserver-data:
